- name: Ensure necessary dependencies are installed
  ansible.builtin.apt:
    name:
      - curl
      - tar
      - jq
      - nodejs
    state: present
    update_cache: true
  become: true
- name: Create runner directory
  ansible.builtin.file:
    path: "{{ runner_path }}"
    state: directory
    mode: '0775'
    owner: "{{ username }}"
    group: "{{ username }}"
  changed_when: false
  become: true
- name: Download GitHub Actions Runner
  ansible.builtin.get_url:
    url: "https://gitea.com/gitea/act_runner/releases/download/v0.2.11/act_runner-0.2.11-linux-amd64"
    dest: "{{ runner_path }}/act_runner"
    owner: "{{ username }}"
    group: "{{ username }}"
    mode: '0755'
  become: true

#- name: Configure GitHub Actions Runner
#  ansible.builtin.command: >
#    ./config.sh --url https://github.com/{{ github_org }}
#    --token {{ github_token }}
#    --name {{ runner_name }}
#    --labels {{ runner_labels }}
#    --runnergroup Default
#    --work _work
#  args:
#    chdir: "{{ runner_path }}"
#    creates: "{{ runner_path }}/.runner"
#  notify: Start Service
#    - Install Service
#    - Start Service
- name: Populate SSH Config
  ansible.builtin.lineinfile:
    path: /home/{{ username }}/.ssh/config
    line: "{{ item }}"
    mode: '0755'
    create: true
  become: true
  with_items:
    - "Host *"
    - "   StrictHostKeyChecking no"

- name: Install AZ CLI
  ansible.builtin.include_tasks: az_cli.yml
- name: Install Ansible
  ansible.builtin.include_tasks: ansible.yml
- name: Install Terraform
  ansible.builtin.include_tasks: terraform.yml
- name: Install Docker
  ansible.builtin.include_tasks: docker.yml
